---
title: "Preventing Brute Force Attack"
date: 2025-04-07 22:00:00 +09:00
categories: [Development, Security]
post: skykhs3
math: true
mermaid: true
image:
  path: /assets/img/posts/2025-04-24-fail2ban/brute_force.webp
  alt: Brute Force Attack on my server
  show_in_post: true
tags:
  - server
  - fail2ban
  - sshd
description: I maintain my own physical server and will share methods to prevent brute-force attacks.
---

<div markdown="1">

> You must set a strong password or SSH key when exposing your server to the internet. Many hacking bots attempt to access your server.
{: .prompt-danger } 

```
fail2ban v1.1.0
Ubuntu 24.04.2 LTS x86_64
```

## 1. Overview
If you maintain your own server, you may be under brute-force attack by bots. As shown in my terminal output, hackers attempt to gain authentication every second.
![Records](/assets/img/posts/2025-04-24-fail2ban/records.webp)
*Number of attempts by hackers to access SSH per IP*

**Setting SSH pubkey is the best option** but I sometimes use other computers and other ips to access remote servers through password authentication. However, since pass authentication is weaker than pub key, **I tried to find a way to enhance ssh security**.

There are two main ways to prevent hacking. One is using a **Firewall (including Web Application Firewall)** and the other is using **programs designed to prevent hacking**. In this post, I will introduce [fail2ban](https://github.com/fail2ban/fail2ban/wiki), an intrusion prevention software. You can easily install and set up [fail2ban](https://github.com/fail2ban/fail2ban/wiki)

## 2. Commands

### 2.1. install
```bash
sudo apt update 
sudo apt install fail2ban
```

### 2.2. Run
If the SSH server access fails multiple times, **fail2ban will ban the IP address that attempted the access**.
```bash
sudo systemctl enable fail2ban # start automatically when boot
sudo systemctl start fail2ban
```

### 2.3. Verify banned ips
```bash
sudo fail2ban-client status sshd
```

```bash
Status for the jail: sshd
|- Filter
|  |- Currently failed:	3
|  |- Total failed:	295
|  `- File list:	/var/log/auth.log
`- Actions
   |- Currently banned:	105
   |- Total banned:	105
   `- Banned IP list:	103.149.28.105 103.171.84.195 103.245.111.90 105.96.26.26 106.12.197.155 117.50.119.25 121.224.115.232 137.184.57.132 14.103.113.224 14.103.118.23 155.4.244.107 159.146.11.164 160.187.241.125 161.35.105.215 161.35.52.212 178.62.51.125 186.233.208.13 186.248.197.77 187.56.132.31 189.203.141.242 190.12.102.58 192.163.200.252 194.0.234.19 202.157.184.3 202.189.254.166 218.0.56.78 222.108.100.117 41.223.40.77 45.116.77.59 54.37.72.28 62.3.42.23 88.214.48.10 88.214.48.11 94.159.101.55 80.104.123.160 14.103.111.167 203.135.101.182 80.94.95.116 80.94.95.115 157.245.99.182 123.58.209.115 206.217.133.9 179.191.229.3 189.23.51.118 180.76.139.209 128.199.183.223 36.97.126.35 45.116.79.186 162.144.85.107 152.32.167.200 61.80.237.194 187.16.96.250 157.10.161.187 196.188.63.174 58.29.36.3 149.86.144.43 14.103.118.145 36.111.189.155 27.254.137.144 119.188.168.53 118.26.36.241 61.80.179.118 189.7.17.61 174.138.85.92 45.157.148.187 128.251.119.173 77.222.128.211 181.188.159.138 186.121.205.29 36.155.14.189 139.59.119.25 14.103.63.16 203.109.35.236 107.150.112.242 83.235.16.111 43.143.254.118 203.194.106.73 193.233.171.153 171.234.154.149 186.31.95.163 209.143.72.134 111.173.105.55 154.209.4.133 213.6.203.226 160.19.78.241 117.34.211.24 160.19.79.72 196.251.83.136 196.251.87.45 151.46.169.201 123.24.206.100 151.44.179.160 179.125.175.19 67.187.189.42 187.170.74.95 119.92.70.82 106.58.187.101 161.35.24.24 185.216.119.226 160.191.52.84 5.78.131.251 117.50.67.183 37.204.226.204 156.232.13.238 103.171.85.231
```

### 2.4. Modify Conditions

`/etc/fail2ban/jail.local`
If `jail.local` does not exist, copy `jail.conf`. fail2ban gives precedence to the setting values in `jail.local` over those in `jail.conf`.

```conf
[DEFAULT]

ignoreip = 1.2.3.5 1.2.3.4 # Set whitelist IP addresses

...

[sshd]
enabled = true
port = ssh # The port number that SSH service is running on
filter = sshd # The name of the filter to use for SSH service monitoring

# Note: auth.log only saves one day of logs and compresses old logs to .gz files
logpath = /var/log/auth.log 

# If an IP fails 3 times within 6000 seconds, it will be banned for 36000 seconds
maxretry = 3
findtime = 6000 
bantime = 36000 # -1 is forever
```

**You must restart fail2ban after modifying conf**
```bash
sudo systemctl restart fail2ban
```

### 2.5. Ban and Unban in manual
```
sudo fail2ban-client set sshd banip 1.2.3.4
sudo fail2ban-client set sshd unbanip 1.2.3.4
```

</div>
